ifneq ($(OS),Windows_NT)
prefix = $(DESTDIR)/usr/local
exec_prefix = $(prefix)
libdir = $(exec_prefix)/lib
endif

ifneq ($(DEBUG),1)
CFLAGS += -Wall -Wextra -Werror -O3 -fPIC
CXXFLAGS += -Wall -Wextra -Werror -O3 -fPIC
else
ifneq ($(OS),Windows_NT)
CFLAGS += -Wall -Wextra -Werror -O0 -g -fsanitize=address -fno-omit-frame-pointer -fPIC
CXXFLAGS += -Wall -Wextra -Werror -O0 -g -fsanitize=address -fno-omit-frame-pointer -fPIC
else
CFLAGS += -Wall -Wextra -Werror -O0 -g -fno-omit-frame-pointer -fPIC
CXXFLAGS += -Wall -Wextra -Werror -O0 -g -fno-omit-frame-pointer -fPIC
endif
endif

NAME=$(shell basename "$(shell pwd)")

LIBNAME=lib$(NAME)

CFLAGS += -DGLOG_NAME=$(NAME)
CXXFLAGS += -DGLOG_NAME=$(NAME)

INCLUDES=include/*
includedir=$(prefix)/include/$(NAME)/include
$(info $(includedir))
ifneq ($(OS),Windows_NT)
LIB=$(LIBNAME).so
else
LIB=$(LIBNAME).dll
endif

all: $(LIB)

$(LIB): $(OBJECTS)
	$(CC) $(CPPFLAGS) $(CFLAGS) $(CXXFLAGS) -shared $(OBJECTS) -o $@ $(LDFLAGS) $(LDLIBS)

clean:
	$(RM) $(LIB) $(OBJECTS)

ifneq ($(OS),Windows_NT)
install: all
	mkdir -p $(prefix)
	mkdir -p $(libdir)
	mkdir -p $(includedir)
	cp $(LIB) $(libdir)
	cp $(INCLUDES) $(includedir)

uninstall:
	-$(RM) $(libdir)/$(LIB)
	rm -rf $(includedir)
	-rmdir $(libdir)
	-rmdir $(prefix)

really-clean: clean uninstall
endif
